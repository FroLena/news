import re
from database import stats_db

# –ñ–ï–°–¢–ö–ò–ô –°–ü–ò–°–û–ö –°–¢–û–ü-–°–õ–û–í
# –ï—Å–ª–∏ –±–æ—Ç –≤–∏–¥–∏—Ç —ç—Ç–æ ‚Äî —Å—Ä–∞–∑—É –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –Ω–æ–≤–æ—Å—Ç—å, –Ω–µ —Ç—Ä–∞—Ç—è –¥–µ–Ω—å–≥–∏ –Ω–∞ GPT.
STOP_PATTERNS = [
    # –†–µ–∫–ª–∞–º–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã
    r"erid:", r"—Ä–µ–∫–ª–∞–º–∞\.", r"#—Ä–µ–∫–ª–∞–º–∞", r"–ø–∞—Ä—Ç–Ω–µ—Ä—Å–∫–∏–π –ø–æ—Å—Ç", r"–Ω–∞ –ø—Ä–∞–≤–∞—Ö —Ä–µ–∫–ª–∞–º—ã",
    r"–ø—Ä–æ–º–æ–∫–æ–¥", r"—Å–∫–∏–¥–∫(–∞|–∏)", r"—Ä–∞—Å–ø—Ä–æ–¥–∞–∂(–∞|–∏)",
    
    # –ü–æ–ø—Ä–æ—à–∞–π–Ω–∏—á–µ—Å—Ç–≤–æ –∏ –ø–µ—Ä–µ–ª–∏–≤—ã
    r"–ø–æ–¥–ø–∏—à–∏—Å—å", r"–ø–æ–¥–ø–∏—Å—ã–≤–∞–π—Å—è", r"—á–∏—Ç–∞—Ç—å –¥–∞–ª—å—à–µ", r"—á–∏—Ç–∞—Ç—å –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ", 
    r"–≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Öüëá", r"—Å—Å—ã–ª–∫–∞ –≤ –æ–ø–∏—Å–∞–Ω–∏–∏", r"–ø–µ—Ä–µ—Ö–æ–¥–∏ –ø–æ —Å—Å—ã–ª–∫–µ",
    r"t\.me/\+", r"t\.me/joinchat", # –°—Å—ã–ª–∫–∏ –Ω–∞ –∑–∞–∫—Ä—ã—Ç—ã–µ –∫–∞–Ω–∞–ª—ã
    
    # –ú—É—Å–æ—Ä–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç
    r"–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ", r"—Å–ø–æ–∫–æ–π–Ω–æ–π –Ω–æ—á–∏", r"–≥–æ—Ä–æ—Å–∫–æ–ø", 
    r"–∫—Ç–æ –Ω–µ —Å–ø–∏—Ç\?", r"–æ—Ç–º–µ—á–∞–π –¥—Ä—É–≥–∞",
    
    # –°–∫–∞–º, –ö—Ä–∏–ø—Ç–∞, –ö–∞–∑–∏–Ω–æ
    r"–∑–∞—Ä–∞–±–æ—Ç–æ–∫", r"–∫—Ä–∏–ø—Ç(–∞|–æ)", r"bitcoin", r"btc", r"usdt", 
    r"–∫–∞–∑–∏–Ω–æ", r"slots", r"–≤—ã–∏–≥—Ä—ã—à", r"—Å—Ö–µ–º(–∞|—ã) –∑–∞—Ä–∞–±–æ—Ç–∫–∞",
    r"—É—Å–ø–µ—à–Ω—ã–π —É—Å–ø–µ—Ö", r"–º–∞–º–æ—á–∫–∏ –≤ –¥–µ–∫—Ä–µ—Ç–µ"
]

def check_stop_words(text):
    """
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–µ–∫—Å—Ç –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º—É—Å–æ—Ä–∞.
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç True, –µ—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–æ —Å—Ç–æ–ø-—Å–ª–æ–≤–æ.
    """
    text_lower = text.lower()
    for pattern in STOP_PATTERNS:
        if re.search(pattern, text_lower):
            return True
    return False

def is_duplicate(text):
    """
    –û–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –¥—É–±–ª–∏ (Fuzzy Match + Hash).
    """
    return stats_db.check_and_add_raw_text(text)
