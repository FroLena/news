import re
from database import stats_db  # <--- Ð˜Ð¼Ð¿Ð¾Ñ€Ñ‚Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð°ÑˆÑƒ Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ…

# "Ð ÐÐ¡Ð¡Ð¢Ð Ð•Ð›Ð¬ÐÐ«Ð™ Ð¡ÐŸÐ˜Ð¡ÐžÐš" (ÐžÑÑ‚Ð°Ð²Ð¸Ð» Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹, ÐºÐ°Ðº Ñ‚Ñ‹ Ð¿Ñ€Ð¾ÑÐ¸Ð»)
STOP_PATTERNS = [
    r"erid:",                # ÐœÐ°Ñ€ÐºÐ¸Ñ€Ð¾Ð²ÐºÐ° Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹
    r"2sub\.org",            # Ð¡ÑÑ‹Ð»ÐºÐ¸-Ð¿Ñ€Ð¾ÐºÐ»Ð°Ð´ÐºÐ¸
    r"t\.me/\+",             # Ð¡ÑÑ‹Ð»ÐºÐ¸ Ð½Ð° Ð·Ð°ÐºÑ€Ñ‹Ñ‚Ñ‹Ðµ ÐºÐ°Ð½Ð°Ð»Ñ‹
    r"#Ñ€ÐµÐºÐ»Ð°Ð¼Ð°",             # Ð¥ÐµÑˆÑ‚ÐµÐ³ Ñ€ÐµÐºÐ»Ð°Ð¼Ñ‹
    r"Ñ€ÐµÐºÐ»Ð°Ð¼Ð°\.",            # Ð¡Ð»Ð¾Ð²Ð¾ Ñ€ÐµÐºÐ»Ð°Ð¼Ð°
    r"https:\.",
    r"Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð´Ð°Ð»ÑŒÑˆÐµ",        # ÐšÐ»Ð¸ÐºÐ±ÐµÐ¹Ñ‚
    r"Ñ‡Ð¸Ñ‚Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð´Ð¾Ð»Ð¶ÐµÐ½Ð¸Ðµ",
    r"Ð² ÐºÐ¾Ð¼Ð¼ÐµÐ½Ñ‚Ð°Ñ€Ð¸ÑÑ…ðŸ‘‡",
    r"Ð·Ð°Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°Ñ‚ÑŒ Ð½Ð°",      # Ð¡ÐºÐ°Ð¼/ÐšÑ€Ð¸Ð¿Ñ‚Ð°
    r"ÑÑ‚Ð°Ð²ÐºÐ¸ Ð½Ð° ÑÐ¿Ð¾Ñ€Ñ‚",      # Ð‘ÐµÑ‚Ñ‚Ð¸Ð½Ð³
    r"Ð´Ð¾Ð±Ñ€Ð¾Ðµ ÑƒÑ‚Ñ€Ð¾",          # ÐœÑƒÑÐ¾Ñ€
    r"ÑÐ¿Ð¾ÐºÐ¾Ð¹Ð½Ð¾Ð¹ Ð½Ð¾Ñ‡Ð¸",       # ÐœÑƒÑÐ¾Ñ€
]

def check_stop_words(text):
    """
    ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ñ‚ÐµÐºÑÑ‚ Ð½Ð° Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ ÑÑ‚Ð¾Ð¿-ÑÐ»Ð¾Ð².
    True = ÐÐ°Ð¹Ð´ÐµÐ½Ð° Ñ€ÐµÐºÐ»Ð°Ð¼Ð°/Ð¼ÑƒÑÐ¾Ñ€.
    """
    text_lower = text.lower()
    for pattern in STOP_PATTERNS:
        if re.search(pattern, text_lower):
            return True
    return False

def is_duplicate(text):
    """
    ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ñ‚ÐµÐºÑÑ‚ Ð½Ð° ÑÑ…Ð¾Ð¶ÐµÑÑ‚ÑŒ Ñ‡ÐµÑ€ÐµÐ· Ð±Ð°Ð·Ñƒ Ð´Ð°Ð½Ð½Ñ‹Ñ… (Ð’ÐµÑ‡Ð½Ð°Ñ Ð¿Ð°Ð¼ÑÑ‚ÑŒ).
    """
    # ÐœÑ‹ Ð±Ð¾Ð»ÑŒÑˆÐµ Ð½Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ð¼ ÑÐ¿Ð¸ÑÐ¾Ðº Ð·Ð´ÐµÑÑŒ. ÐœÑ‹ Ð¾Ñ‚Ð´Ð°ÐµÐ¼ Ñ‚ÐµÐºÑÑ‚ Ð² Ð±Ð°Ð·Ñƒ.
    # Ð‘Ð°Ð·Ð° ÑÐ°Ð¼Ð° ÑÑ€Ð°Ð²Ð½Ð¸Ñ‚ ÐµÐ³Ð¾ Ñ Ð¸ÑÑ‚Ð¾Ñ€Ð¸ÐµÐ¹ Ð·Ð° 24 Ñ‡Ð°ÑÐ°.
    # Ð•ÑÐ»Ð¸ Ð²ÐµÑ€Ð½ÐµÑ‚ True â€” Ð·Ð½Ð°Ñ‡Ð¸Ñ‚ Ð´ÑƒÐ±Ð»ÑŒ.
    return stats_db.check_and_add_raw_text(text)
